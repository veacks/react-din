/* Node-based Playground Styles */

.react-flow__node {
    border-radius: 8px;
    background: var(--node-bg);
    color: var(--text);
    border: 1px solid var(--node-border);
    font-size: 12px;
    box-shadow: var(--node-shadow);
    min-width: 150px;
}

.react-flow__node.selected {
    border-color: var(--accent);
    box-shadow: var(--node-shadow-focus);
}

.react-flow {
    background: var(--canvas-bg);
}

.react-flow__background {
    background: var(--canvas-bg);
}

.audio-node {
    display: flex;
    flex-direction: column;
    /* overflow: hidden;  <-- Removed to allow handles with negative offsets to be visible */
    background: var(--node-bg);
    border: 1px solid var(--node-border);
    border-radius: 8px;
    box-shadow: var(--node-shadow);
    font-family: inherit;
}

.audio-node.selected {
    border-color: var(--accent);
    box-shadow: var(--node-shadow-focus);
}

.node-header {
    padding: 8px 12px;
    background: var(--node-header-bg);
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 1px solid var(--node-border);
    color: var(--node-header-text);
    cursor: grab;
}

.node-header:active {
    cursor: grabbing;
}

.osc-node .node-header {
    background: #ff8844;
    color: #fff;
}

.gain-node .node-header {
    background: #44cc44;
    color: #fff;
}

.filter-node .node-header {
    background: #aa44ff;
    color: #fff;
}

.output-node .node-header {
    background: #ff4466;
    color: #fff;
}

.noise-node .node-header {
    background: #666666;
    color: #fff;
}

.delay-node .node-header {
    background: #4488ff;
    color: #fff;
}

.reverb-node .node-header {
    background: #8844ff;
    color: #fff;
}

.panner-node .node-header {
    background: #44cccc;
    color: #042222;
}

.mixer-node .node-header {
    background: #ffaa44;
    color: #2b1b00;
}

.input-node .node-header {
    background: #555555;
    color: #fff;
}

.node-icon {
    font-size: 14px;
}

.node-title {
    flex: 1;
}

.node-content {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.node-control {
    display: flex;
    flex-direction: column;
    gap: 4px;
    position: relative;
    /* For handle positioning */
    min-height: 40px;
    /* Ensure space for handle */
    justify-content: center;
}

.node-control label {
    font-size: 10px;
    text-transform: uppercase;
    color: var(--text-muted);
    letter-spacing: 0.5px;
}

.node-control input[type="range"] {
    width: 100%;
    margin: 4px 0;
    height: 3px;
    border-radius: 999px;
    background: var(--control-border);
    outline: none;
    -webkit-appearance: none;
}

.node-control input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--accent);
    cursor: pointer;
}

.node-control select {
    background: var(--control-bg);
    color: var(--text);
    border: 1px solid var(--control-border);
    padding: 4px;
    border-radius: 4px;
    font-size: 11px;
}

.node-control input[type="number"] {
    background: var(--control-bg);
    color: var(--text);
    border: 1px solid var(--control-border);
    padding: 4px;
    border-radius: 4px;
    font-size: 11px;
    width: 100%;
}

.node-control .value {
    font-size: 10px;
    color: var(--accent);
    text-align: right;
}

/* Handle Styles */
.react-flow__handle {
    width: 10px;
    height: 10px;
    border: 2px solid var(--node-bg);
    border-radius: 50%;
    transition: all 0.2s;
    z-index: 10;
    background: var(--control-border);
    transform-origin: center;
}

/* Audio Handles (Green) */
.handle-audio {
    background: #00ff41 !important;
    /* Bright Green */
    border-color: #00ff41 !important;
}

/* Parameter Handles (Blue) */
.handle-param {
    background: var(--accent) !important;
    /* Bright Blue */
}

.handle-in {
    border-radius: 50%;
}

.handle-out {
    border-radius: 50%;
}

.node-control .react-flow__handle-left {
    left: -12px;
}

.node-control .react-flow__handle-right {
    right: -12px;
}

/* Handle Hover */
.react-flow__handle:hover {
    transform: scale(1.2);
    border-color: var(--node-header-text);
}

/* Labels for Audio Sockets */
.handle-label {
    position: absolute;
    font-size: 9px;
    color: var(--text-subtle);
    pointer-events: none;
    white-space: nowrap;
    text-transform: uppercase;
}

.handle-label-in {
    left: 12px;
    top: -2px;
}

.handle-label-out {
    right: 12px;
    top: -2px;
}

.play-button {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
}

.play-button:hover {
    transform: translateY(-1px);
}

.play-button.play {
    background: var(--success);
    color: #fff;
}

.play-button.stop {
    background: var(--danger);
    color: #fff;
}

.output-node.playing {
    animation: output-pulse 1s ease-in-out infinite;
}

@keyframes output-pulse {

    0%,
    100% {
        box-shadow: var(--node-shadow);
    }

    50% {
        box-shadow: 0 0 18px rgba(239, 68, 68, 0.35);
    }
}

/* Node Palette */
.node-palette {
    width: 200px;
    background: var(--panel-bg);
    border-right: 1px solid var(--panel-border);
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
}

.palette-category h4 {
    margin: 0 0 8px 0;
    font-size: 11px;
    text-transform: uppercase;
    color: var(--text-subtle);
    padding-bottom: 4px;
    border-bottom: 1px solid var(--panel-border);
}

.palette-nodes {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.palette-node {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: var(--panel-muted);
    border-radius: 4px;
    border-left: 3px solid transparent;
    cursor: grab;
    transition: background 0.2s;
    user-select: none;
}

.palette-node:hover {
    background: var(--panel-bg);
}

.palette-node .icon {
    font-size: 16px;
}

/* Layout */
.playground-container {
    display: flex;
    height: 100vh;
    width: 100%;
    background: var(--app-bg);
    color: var(--text);
}

.flow-container {
    flex: 1;
    position: relative;
}

/* Connection Lines */
.react-flow__edge-path {
    stroke: var(--edge-color);
    stroke-width: 2px;
    transition: stroke 0.2s ease;
}

.react-flow__edge-path:hover {
    stroke: var(--accent);
}

/* Audio Connections - Green Edge */
/* We can't easily select audio vs param edges with pure CSS unless we add classes to edges in JS. 
   But we requested green sockets. The edge color is usually determined by the source handle. 
   If we can force edges to default to green, or use JS to color them. 
   For now, we'll try to style them via the component or global override if possible, 
   but specific edge coloring usually requires edge types or 'style' prop on edge object. */

/* Custom Params in Input Node */
.custom-param {
    position: relative;
    padding: 6px;
    background: var(--panel-muted);
    border-radius: 4px;
    margin-bottom: 4px;
}

.custom-param .param-name {
    display: block;
    margin-bottom: 4px;
    font-size: 11px;
}

.remove-param {
    position: absolute;
    top: 2px;
    right: 2px;
    background: none;
    border: none;
    color: var(--text-subtle);
    cursor: pointer;
    font-size: 12px;
    padding: 0 4px;
}

.remove-param:hover {
    color: var(--danger);
}

.add-param {
    display: flex;
    gap: 6px;
    margin-top: 8px;
}

.add-param input {
    flex: 1;
    background: var(--control-bg);
    border: 1px solid var(--control-border);
    color: var(--text);
    padding: 4px;
    border-radius: 4px;
    font-size: 11px;
}

.add-param button {
    background: var(--panel-border);
    color: var(--text);
    border: none;
    padding: 0 8px;
    border-radius: 4px;
    cursor: pointer;
}

.add-param button:hover {
    background: var(--control-border);
}

/* Note Node */
.note-display {
    margin-top: 8px;
    padding: 8px;
    background: var(--panel-muted);
    border-radius: 4px;
    text-align: center;
}

.note-display .note-name {
    display: block;
    font-size: 16px;
    font-weight: bold;
    color: #ffcc00;
}

.note-display .freq {
    display: block;
    font-size: 10px;
    color: var(--text-subtle);
}

.lang-toggle {
    margin-left: auto;
    background: var(--panel-muted);
    border: 1px solid var(--panel-border);
    border-radius: 4px;
    cursor: pointer;
    font-size: 10px;
    padding: 2px 6px;
    color: var(--text);
    opacity: 0.9;
    text-transform: uppercase;
}

.lang-toggle:hover {
    background: var(--panel-border);
    opacity: 1;
}


/* Input Node Specifics */
.input-node .node-header {
    justify-content: space-between;
    position: relative;
}

.input-node .header-title {
    display: flex;
    align-items: center;
    gap: 8px;
}


.input-param-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 20px;
    /* Aligns with handle area */
}

.input-param-row label {
    margin: 0;
}

.input-param-label {
    margin: 0;
    color: var(--text-muted);
}

.text-no-outputs {
    font-style: italic;
    color: var(--text-subtle);
    font-size: 10px;
}


.react-flow__minimap {
    background: var(--minimap-bg);
    border-radius: 8px;
}

.react-flow__controls {
    border-radius: 8px;
    overflow: hidden;
}

.react-flow__controls-button {
    background: var(--controls-bg);
    border-bottom: 1px solid var(--panel-border);
}

.react-flow__controls-button:hover {
    background: var(--panel-muted);
}

.react-flow__controls-button svg {
    fill: var(--text-muted);
}



/* Sequencer Node */
.sequencer-node {
    width: max-content;
    min-width: unset;
}

.sequencer-node .node-content {
    padding: 8px;
}

.sequencer-steps-row {
    display: flex;
    flex-direction: row;
    gap: 2px;
}

.step-column {
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: center;
    width: 24px;
}

.sequencer-pad {
    width: 100%;
    aspect-ratio: 1;
    background: var(--control-border);
    border: none;
    padding: 0;
    margin: 0;
    border-radius: 2px;
    cursor: pointer;
    transition: background 0.1s;
}

.sequencer-pad.active {
    background: #ffcc00;
    box-shadow: 0 0 4px #ffcc00;
}

/* ADSR Node Styles */
.adsr-viz {
    margin-bottom: 10px;
    background: var(--panel-muted);
    border-radius: 4px;
    padding: 5px;
    overflow: hidden;
}

.adsr-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

.control-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.control-group label {
    font-size: 10px;
    color: var(--text-muted);
}

.audio-node.adsr-node .node-content {
    padding: 8px;
}

.adsr-viz svg {
    display: block;
}

.adsr-handle {
    fill: var(--panel-bg);
    stroke: var(--accent);
    stroke-width: 2px;
    pointer-events: all;
    transition: r 0.1s ease;
}

.adsr-handle:hover {
    r: 6px;
}

.adsr-handle.attack {
    cursor: ew-resize;
}

.adsr-handle.decay {
    cursor: move;
}

.adsr-handle.release {
    cursor: ew-resize;
}

.velocity-bar-container {
    width: 100%;
    height: 60px;
    position: relative;
    background: var(--panel-muted);
    border-radius: 2px;
    overflow: hidden;
}

.velocity-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #ffcc00;
    opacity: 0.5;
    pointer-events: none;
}

.velocity-input {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    /* height of container */
    height: 24px;
    /* width of container */
    opacity: 0;
    cursor: ns-resize;
    transform-origin: bottom left;
    transform: rotate(-90deg) translate(0, 24px);
    /* translate(0, width of container) */
    margin: 0;
    padding: 0;
    -webkit-appearance: slider-vertical;
}

/* Fallback/Correction for input range if needed */
.step-column:hover .velocity-input {
    /* debugging help: opacity: 0.2; */
}

.sequencer-pad.active+.velocity-bar-container .velocity-bar {
    opacity: 1;
}

/* Piano Roll Node Styles */
.piano-roll-node {
    min-width: 400px;
}

.piano-roll-grid {
    display: flex;
    gap: 2px;
    max-height: 300px;
    overflow-y: auto;
}

.piano-keys {
    display: flex;
    flex-direction: column;
    gap: 1px;
    flex-shrink: 0;
}

.piano-key {
    width: 40px;
    height: 12px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 4px;
    font-size: 8px;
    border-radius: 2px 0 0 2px;
}

.piano-key.white {
    background: var(--panel-bg);
    color: var(--text);
}

.piano-key.black {
    background: var(--panel-border);
    color: var(--text-subtle);
}

.key-label {
    font-weight: bold;
}

.piano-grid-container {
    display: flex;
    flex-direction: column;
    gap: 1px;
    flex-grow: 1;
    overflow-x: auto;
}

.piano-grid-row {
    display: flex;
    gap: 1px;
}

.piano-cell {
    width: 16px;
    height: 12px;
    background: var(--panel-muted);
    border: none;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.1s;
    padding: 0;
}

.piano-cell:hover {
    background: var(--panel-border);
}

.piano-cell.active {
    background: var(--accent);
}

.piano-cell.current {
    box-shadow: inset 0 0 0 1px var(--panel-bg);
}

.piano-cell.beat {
    background: var(--control-border);
}

.piano-cell.beat:hover {
    background: var(--panel-border);
}

.piano-cell.beat.active {
    background: var(--accent);
}

/* Piano Roll extended note styles */
.piano-cell.note-cont {
    background: var(--accent);
    border-left: none;
    border-radius: 0;
}

.piano-cell.note-start {
    border-radius: 3px 0 0 3px;
}

.piano-cell.selecting {
    background: rgba(96, 165, 250, 0.35);
}