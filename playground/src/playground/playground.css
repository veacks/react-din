/* Node-based Playground Styles */

.react-flow__node {
    border-radius: 8px;
    background: #1a1a1a;
    color: #eee;
    border: 1px solid #333;
    font-size: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    min-width: 150px;
}

.react-flow__node.selected {
    border-color: #646cff;
    box-shadow: 0 0 0 2px rgba(100, 108, 255, 0.5);
}

.audio-node {
    display: flex;
    flex-direction: column;
    /* overflow: hidden;  <-- Removed to allow handles (left: -10px) to be visible */
    background: #222;
    border-radius: 8px;
}

.node-header {
    padding: 8px 12px;
    background: #333;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 8px;
    border-bottom: 1px solid #444;
}

.node-icon {
    font-size: 14px;
}

.node-content {
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.node-control {
    display: flex;
    flex-direction: column;
    gap: 4px;
    position: relative;
    /* For handle positioning */
    min-height: 40px;
    /* Ensure space for handle */
    justify-content: center;
}

.node-control label {
    font-size: 10px;
    text-transform: uppercase;
    color: #888;
    letter-spacing: 0.5px;
}

.node-control input[type="range"] {
    width: 100%;
    margin: 4px 0;
}

.node-control select {
    background: #333;
    color: #eee;
    border: 1px solid #444;
    padding: 4px;
    border-radius: 4px;
    font-size: 11px;
}

.node-control .value {
    font-size: 10px;
    color: #aaa;
    text-align: right;
}

/* Handle Styles */
.react-flow__handle {
    width: 10px;
    height: 10px;
    border: 2px solid #222;
    transition: all 0.2s;
    z-index: 10;
}

/* Audio Handles (Green) */
.handle-audio {
    background: #00ff41 !important;
    /* Bright Green */
    border-color: #00ff41 !important;
}

/* Parameter Handles (Blue) */
.handle-param {
    background: #007bff !important;
    /* Bright Blue */
    left: -6px !important;
}

.handle-in {
    border-radius: 50%;
}

.handle-out {
    border-radius: 50%;
}

/* Handle Hover */
.react-flow__handle:hover {
    transform: scale(1.2);
    border-color: #fff;
}

/* Labels for Audio Sockets */
.handle-label {
    position: absolute;
    font-size: 9px;
    color: #888;
    pointer-events: none;
    white-space: nowrap;
    text-transform: uppercase;
}

.handle-label-in {
    left: 12px;
    top: -2px;
}

.handle-label-out {
    right: 12px;
    top: -2px;
}

/* Node Palette */
.node-palette {
    width: 200px;
    background: #1a1a1a;
    border-right: 1px solid #333;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
}

.palette-category h4 {
    margin: 0 0 8px 0;
    font-size: 11px;
    text-transform: uppercase;
    color: #666;
    padding-bottom: 4px;
    border-bottom: 1px solid #333;
}

.palette-nodes {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.palette-node {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 12px;
    background: #2a2a2a;
    border-radius: 4px;
    border-left: 3px solid transparent;
    cursor: grab;
    transition: background 0.2s;
    user-select: none;
}

.palette-node:hover {
    background: #333;
}

.palette-node .icon {
    font-size: 16px;
}

/* Layout */
.playground-container {
    display: flex;
    height: 100vh;
    width: 100%;
    background: #111;
    color: #eee;
}

.flow-container {
    flex: 1;
    position: relative;
}

/* Connection Lines */
.react-flow__edge-path {
    stroke-width: 2px;
}

/* Audio Connections - Green Edge */
/* We can't easily select audio vs param edges with pure CSS unless we add classes to edges in JS. 
   But we requested green sockets. The edge color is usually determined by the source handle. 
   If we can force edges to default to green, or use JS to color them. 
   For now, we'll try to style them via the component or global override if possible, 
   but specific edge coloring usually requires edge types or 'style' prop on edge object. */

/* Custom Params in Input Node */
.custom-param {
    position: relative;
    padding: 6px;
    background: #2a2a2a;
    border-radius: 4px;
    margin-bottom: 4px;
}

.custom-param .param-name {
    display: block;
    margin-bottom: 4px;
    font-size: 11px;
}

.remove-param {
    position: absolute;
    top: 2px;
    right: 2px;
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    font-size: 12px;
    padding: 0 4px;
}

.remove-param:hover {
    color: #f44;
}

.add-param {
    display: flex;
    gap: 6px;
    margin-top: 8px;
}

.add-param input {
    flex: 1;
    background: #333;
    border: 1px solid #444;
    color: #eee;
    padding: 4px;
    border-radius: 4px;
    font-size: 11px;
}

.add-param button {
    background: #444;
    color: #eee;
    border: none;
    padding: 0 8px;
    border-radius: 4px;
    cursor: pointer;
}

.add-param button:hover {
    background: #555;
}

/* Note Node */
.note-display {
    margin-top: 8px;
    padding: 8px;
    background: #111;
    border-radius: 4px;
    text-align: center;
}

.note-display .note-name {
    display: block;
    font-size: 16px;
    font-weight: bold;
    color: #ffcc00;
}

.note-display .freq {
    display: block;
    font-size: 10px;
    color: #888;
}

.lang-toggle {
    margin-left: auto;
    background: #444;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 10px;
    padding: 2px 6px;
    color: #eee;
    opacity: 0.9;
    text-transform: uppercase;
}

.lang-toggle:hover {
    background: #555;
    opacity: 1;
}


/* Input Node Specifics */
.input-node .node-header {
    justify-content: space-between;
    position: relative;
}

.input-node .header-title {
    display: flex;
    align-items: center;
    gap: 8px;
}

.input-transport-control {
    min-height: 40px;
}

.input-control-stack {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.input-param-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 20px;
    /* Aligns with handle area */
}

.input-param-row label {
    margin: 0;
}

.input-param-label {
    margin: 0;
    color: #ccc;
}

.text-no-outputs {
    font-style: italic;
    color: #666;
    font-size: 10px;
}

.socket-fix {
    position: relative;
    transform: none;
    right: -14px;
}

.socket-fix-bpm {
    position: relative;
    transform: none;
    right: -14px;
}


/* Sequencer Node */
.sequencer-node {
    width: max-content;
    min-width: unset;
}

.sequencer-node .node-content {
    padding: 8px;
}

.sequencer-steps-row {
    display: flex;
    flex-direction: row;
    gap: 2px;
}

.step-column {
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: center;
    width: 24px;
}

.sequencer-pad {
    width: 100%;
    aspect-ratio: 1;
    background: #444;
    border: none;
    padding: 0;
    margin: 0;
    border-radius: 2px;
    cursor: pointer;
    transition: background 0.1s;
}

.sequencer-pad.active {
    background: #ffcc00;
    box-shadow: 0 0 4px #ffcc00;
}

/* ADSR Node Styles */
.adsr-viz {
    margin-bottom: 10px;
    background: #222;
    border-radius: 4px;
    padding: 5px;
    overflow: hidden;
}

.adsr-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
}

.control-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.control-group label {
    font-size: 10px;
    color: #aaa;
}

.audio-node.adsr-node .node-content {
    padding: 8px;
}

.adsr-viz svg {
    display: block;
}

.handle-label {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 10px;
    color: #aaa;
    pointer-events: none;
}

.handle-label-in {
    left: 10px;
}

.adsr-handle {
    fill: #fff;
    stroke: #0088ff;
    stroke-width: 2px;
    pointer-events: all;
    transition: r 0.1s ease;
}

.adsr-handle:hover {
    r: 6px;
}

.adsr-handle.attack {
    cursor: ew-resize;
}

.adsr-handle.decay {
    cursor: move;
}

.adsr-handle.release {
    cursor: ew-resize;
}

.velocity-bar-container {
    width: 100%;
    height: 60px;
    position: relative;
    background: #222;
    border-radius: 2px;
    overflow: hidden;
}

.velocity-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #ffcc00;
    opacity: 0.5;
    pointer-events: none;
}

.velocity-input {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    /* height of container */
    height: 24px;
    /* width of container */
    opacity: 0;
    cursor: ns-resize;
    transform-origin: bottom left;
    transform: rotate(-90deg) translate(0, 24px);
    /* translate(0, width of container) */
    margin: 0;
    padding: 0;
    -webkit-appearance: slider-vertical;
}

/* Fallback/Correction for input range if needed */
.step-column:hover .velocity-input {
    /* debugging help: opacity: 0.2; */
}

.sequencer-pad.active+.velocity-bar-container .velocity-bar {
    opacity: 1;
}
/* Piano Roll Node Styles */
.piano-roll-node {
    min-width: 400px;
}

.piano-roll-grid {
    display: flex;
    gap: 2px;
    max-height: 300px;
    overflow-y: auto;
}

.piano-keys {
    display: flex;
    flex-direction: column;
    gap: 1px;
    flex-shrink: 0;
}

.piano-key {
    width: 40px;
    height: 12px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 4px;
    font-size: 8px;
    border-radius: 2px 0 0 2px;
}

.piano-key.white {
    background: #eee;
    color: #333;
}

.piano-key.black {
    background: #333;
    color: #888;
}

.key-label {
    font-weight: bold;
}

.piano-grid-container {
    display: flex;
    flex-direction: column;
    gap: 1px;
    flex-grow: 1;
    overflow-x: auto;
}

.piano-grid-row {
    display: flex;
    gap: 1px;
}

.piano-cell {
    width: 16px;
    height: 12px;
    background: #2a2a2a;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.1s;
    padding: 0;
}

.piano-cell:hover {
    background: #444;
}

.piano-cell.active {
    background: #44ccff;
}

.piano-cell.current {
    box-shadow: inset 0 0 0 1px #fff;
}

.piano-cell.beat {
    background: #333;
}

.piano-cell.beat:hover {
    background: #555;
}

.piano-cell.beat.active {
    background: #44ccff;
}

/* Piano Roll extended note styles */
.piano-cell.note-cont {
    background: #2299cc;
    border-left: none;
    border-radius: 0;
}

.piano-cell.note-start {
    border-radius: 3px 0 0 3px;
}

.piano-cell.selecting {
    background: rgba(68, 204, 255, 0.5);
}
